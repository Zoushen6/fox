(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3d91a8a1","chunk-209e806e"],{"04bd":function(t,e,a){var i=a("e7b1"),n=a("d10e"),o=a("28c8"),l=a("4ca1"),s=a("4f50"),r=a("7fc1"),c=/MSIE .\./.test(s),d=n.Function,u=function(t){return function(e,a){var i=arguments.length>2,n=i?r(arguments,2):void 0;return t(i?function(){o(l(e)?e:d(e),this,n)}:e,a)}};i({global:!0,bind:!0,forced:c},{setTimeout:u(n.setTimeout),setInterval:u(n.setInterval)})},"0874":function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));a("5232"),a("87c5"),a("fd72"),a("1981"),a("a3ad"),a("665c"),a("d6b0");var i=a("84b9");function n(t,e){if(t){if("string"===typeof t)return Object(i["a"])(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Object(i["a"])(t,e):void 0}}},"110e":function(t,e,a){"use strict";a("63e8")},1981:function(t,e,a){var i=a("e7b1"),n=a("0637"),o=a("4df9"),l=!o((function(t){Array.from(t)}));i({target:"Array",stat:!0,forced:l},{from:n})},"1df7":function(t,e,a){"use strict";a("6bb0")},2149:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container flex m-b-16 h-100"},[a("select-label",{staticClass:"m-l-16",attrs:{amount:t.amount,status:t.state},on:{getLabel:t.getLabel}}),a("operation-pool",{staticClass:"m-l-r-16",attrs:{info:t.labelInfo,operationID:t.operationItem},on:{operationAmount:t.operationAmount,resetLabelData:t.resetLabelData}})],1)},n=[],o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"select-label"},[a("div",{staticClass:"title"},[t._v("选择标签：")]),a("div",{staticClass:"select-type"},t._l(t.labelList,(function(e,i){return a("el-button",{key:i,class:t.label===e.en_label?"btn":"",on:{click:function(a){return t.selectLabel(e.en_label)}}},[t._v(" "+t._s(e.label)+" ")])})),1),"time"===t.label?a("div",{staticClass:"time time-title"},[a("div",{staticClass:"title"},[t._v("选择时间范围：")]),a("customized-time-picker",{staticClass:"time-picker long-item m-t-25",attrs:{date:t.dateValue,shortcutsSetting:t.shortcutsSetting,"max-date":1,"min-date":t.minDate},on:{"update:date":function(e){t.dateValue=e},change:t.handleChange}})],1):t._e(),"activity_id"===t.label?a("div",{staticClass:"equipment time-title"},[a("div",{staticClass:"title"},[t._v("选择活动名称：")]),a("el-form",{staticClass:"customized-form"},[a("el-form-item",{staticClass:"long-item m-t-25"},[a("el-select",{attrs:{placeholder:"请选择",multiple:"",clearable:"",filterable:""},on:{change:t.handleChange},model:{value:t.activeID,callback:function(e){t.activeID=e},expression:"activeID"}},t._l(t.allList.activity_id,(function(t){return a("el-option",{key:t.def_id,attrs:{label:t.label_name,value:t.def_id}})})),1)],1)],1)],1):t._e(),"play_progress"===t.label?a("div",{staticClass:"equipment time-title"},[a("div",{staticClass:"title"},[t._v("播放进度：")]),a("el-form",{staticClass:"customized-form"},[a("el-form-item",{staticClass:"long-item m-t-25"},[a("el-select",{attrs:{multiple:"",placeholder:"请选择(可多选)"},on:{change:t.handleChange},model:{value:t.playbackProgress,callback:function(e){t.playbackProgress=e},expression:"playbackProgress"}},t._l(t.allList.play_progress,(function(t){return a("el-option",{key:t.def_id,attrs:{label:t.label,value:t.def_id}})})),1)],1)],1)],1):t._e(),t.label&&1===t.operationAmount?a("el-button",{staticClass:"add-button iconfont icon-add",attrs:{size:"small"},on:{click:function(e){return t.addLabel(1)}}},[t._v("添加")]):t._e(),t.label&&1!==t.operationAmount?a("el-dropdown",{attrs:{trigger:"click"},on:{command:t.addLabel}},[a("el-button",{staticClass:"add-button iconfont icon-add",attrs:{plain:"",size:"small"}},[t._v("添加")]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.operationAmount,(function(e){return a("el-dropdown-item",{key:e,attrs:{command:e}},[t._v("运算池"+t._s(e)+" ")])})),1)],1):t._e()],1)},l=[],s=(a("9664"),a("996d"),a("dfcf"),a("00fe"),a("87c5"),a("11e1"),a("f904")),r=a("6e27"),c={name:"SelectLabel",components:{CustomizedTimePicker:r["default"]},props:{amount:{type:Number},status:{type:Boolean,default:!0}},watch:{amount:{handler:function(t){this.operationAmount=t},immediate:!0},status:{handler:function(t){t||(this.operationAmount=1,this.label="",this.reset())},immediate:!0}},data:function(){return{common:s["a"],label:"",labelList:[],dateValue:[],shortcutsSetting:["lastSeven","lastThirty","lastNinety","curWeek","lastWeek","curMonth","lastMonth"],minDate:Math.ceil((new Date-new Date("2018-1-1"))/864e5),equipment:[],equipmentList:[],activeID:[],activeIdList:[],playbackProgress:[],playbackProgressList:[],operationAmount:1,allList:{activity_id:[],play_progress:[]},labelInfo:{activity_id:{label:"活动名称",list:{label_id:"",def_id:[],label:"",value:""}},play_progress:{label:"播放进度",list:{label_id:"",def_id:[],label:"",value:""}},time:{label:"时间范围",list:{label_id:"",def_id:"0",label:"",value:""}}}}},activated:function(){this.getLabelList(),this.getLabelType()},deactivated:function(){this.operationAmount=1,this.label="",this.reset()},methods:{getLabelList:function(){var t=this;this.$http.get("label/type").then((function(e){200===e.data.code&&(t.labelList=e.data.data.list)}))},handleChange:function(t){var e=this;if(t&&(this.labelInfo[this.label].list.label_id=this.labelList.map((function(t){var a="";return e.allList[e.label].forEach((function(e){e.label_id==t.label_id&&(a=e.label_id)})),a})).join("")),"time"!==this.label)this.labelInfo[this.label].list.def_id=t.join(","),this.labelInfo[this.label].list.label=t.map((function(t){var a="";return e.allList[e.label].forEach((function(e){e.def_id===t&&(a=e.label_name)})),a})).join(",");else{var a=[this.common.getNewDay(this.dateValue[0]),this.common.getNewDay(this.dateValue[1])].join(",");this.labelInfo[this.label].list.label=a,this.labelInfo[this.label].list.value=a}},getLabelType:function(){var t=this;this.$http.get("/label/list").then((function(e){200===e.data.code&&(t.allList=e.data.data.list)}))},selectLabel:function(t){this.label=t},reset:function(){this.dateValue=[],this.equipment=[],this.activeID=[],this.playbackProgress=[]},addLabel:function(t){var e=this.common.deepCopy(this.labelInfo[this.label],{});this.labelInfo[this.label].list.label&&(this.$emit("getLabel",e,t),this.labelInfo[this.label].list.label="",this.reset())}}},d=c,u=(a("110e"),a("cba8")),f=Object(u["a"])(d,o,l,!1,null,"53e46bea",null),m=f.exports,p=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"operation-pool"},[t._l(t.operation,(function(e,i){return a("div",{key:i,staticClass:"m-b-16 container"},[a("div",{staticClass:"head-title flex"},[a("div",{staticClass:"title"},[t._v("运算池"+t._s(i+1)+"：")]),a("div",{staticClass:"all"},[t.operation.length>1?a("span",{staticClass:"iconfont icon-delete",on:{click:function(e){return t.deleteOperation(i)}}}):t._e(),a("el-button-group",{staticClass:"all"},[a("el-button",{staticClass:"and",class:1===e.in_condition?"btn":"",on:{click:function(a){return t.operationAnd(e.in_condition=1)}}},[t._v("池内取并集 ")]),a("el-button",{staticClass:"or",class:2===e.in_condition?"btn":"",on:{click:function(a){return t.operationOr(e.in_condition=2)}}},[t._v("池内取交集 ")])],1)],1)]),a("div",{staticClass:"operation-box"},t._l(e.operationLabel,(function(e,n){return a("div",{key:n,staticClass:"operation-item"},["时间范围"!==e.label?a("span",{staticClass:"iconfont icon-close",on:{click:function(e){return t.deleteLabel(i,n)}}}):t._e(),a("p",[t._v(t._s(e.label))]),a("p",[t._v(t._s(e.list.label))])])})),0),""!==e.gather?a("div",{staticClass:"gather flex"},[t._m(0,!0),a("div",{staticClass:"right flex-vertical"},[a("el-form",{staticClass:"customized-form"},[a("el-form-item",{staticClass:"short-item m-t-30"},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.out_condition,callback:function(a){t.$set(e,"out_condition",a)},expression:"ite.out_condition"}},t._l(t.gatherList,(function(t){return a("el-option",{key:t.value,attrs:{label:t.name,value:t.value}})})),1)],1)],1)],1)]):t._e(),""===e.gather?a("div",{staticClass:"add-operation"},[e.addItem?a("div",{staticClass:"add-item"},[a("span",[t._v("选择运算池间的关系：")]),t._l(t.gatherList,(function(e,n){return a("el-radio",{key:n,attrs:{label:n},on:{change:function(a){return t.handleChange(e.value,i)}},model:{value:t.radio,callback:function(e){t.radio=e},expression:"radio"}},[t._v(" "+t._s(e.name)+" ")])}))],2):a("el-button",{staticClass:"iconfont icon-add",attrs:{plain:""},on:{click:function(e){return t.addOperation(i)}}},[t._v("添加运算池 ")])],1):t._e()])})),a("div",{staticClass:"device-type"},[a("div",{staticClass:"device"},[t._v("匹配类型：")]),a("el-form",{ref:"deviceForm",staticClass:"customized-form",attrs:{model:t.deviceForm,rules:t.deviceRule}},[a("el-form-item",{staticClass:"long-item",attrs:{prop:"device"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.deviceForm.device,callback:function(e){t.$set(t.deviceForm,"device",e)},expression:"deviceForm.device"}},t._l(t.deviceType,(function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1)],1)],1),a("div",{staticClass:"start-estimate"},[a("el-button",{on:{click:t.startOperation}},[t._v("开始预估人群")])],1),a("customized-dialog",{staticClass:"operation-dialog",attrs:{width:660,title:"保存人群",visible:t.visibleOperation},on:{close:t.closeDialog,cancel:t.closeDialog}},[a("el-form",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"operationForm",staticClass:"customized-form overflow-hidden",attrs:{rules:t.operationRules,model:t.operationForm}},[a("el-form-item",{staticClass:"item-title",attrs:{label:"预计覆盖人数："}},[a("span",[t._v(t._s(1===t.packageStatus?t.packageNum:0))])]),a("el-form-item",{staticClass:"long-item",attrs:{prop:"crowdName",label:"人群名称","label-width":"80px"}},[a("el-input",{model:{value:t.operationForm.crowdName,callback:function(e){t.$set(t.operationForm,"crowdName",e)},expression:"operationForm.crowdName"}})],1),a("el-form-item",{staticClass:"f-r"},[a("el-button",{attrs:{type:"primary"},on:{click:t.submitOperation}},[t._v("确定")])],1)],1)],1),a("text-dialog",{ref:"delete",staticClass:"text-dialog",attrs:{text:t.textDialog.text,textClass:t.textDialog.class,"show-footer":t.textDialog.showFooter},on:{success:t.submitDelete,dialogClose:t.closeTextDialog}})],2)},b=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"left m-t-25"},[a("div",{staticClass:"point"}),a("div",{staticClass:"mid"}),a("div",{staticClass:"point"})])}],h=a("6afb"),v=(a("8d54"),a("cc84"),a("cddc"),a("04bd"),a("4ff3")),g=a.n(v),_=a("7eeb"),y=a("7b65"),C=a("2460"),D={name:"OperationPool",components:{CustomizedDialog:C["default"],TextDialog:y["a"]},props:{info:{type:Object},operationID:{type:Number}},watch:{info:{handler:function(t){var e=this;this.operation.forEach((function(a,i){if(i+1===e.operationID){var n=a.operationLabel.find((function(e){return e.label===t.label}));n?Object.assign(n,t):a.operationLabel.push(t)}}))},immediate:!0}},data:function(){return{textDialog:{text:"",class:"",showFooter:!0},operationLabelCopy:null,operation:[{operationLabel:[{label:"时间范围",list:{label_id:"1",def_id:"0",label:[s["a"].getNewDay(Object(_["d"])(7,0)[0]),s["a"].getNewDay(Object(_["d"])(7,0)[1])].join(","),value:[s["a"].getNewDay(Object(_["d"])(7,0)[0]),s["a"].getNewDay(Object(_["d"])(7,0)[1])].join(",")}}],gather:"",addItem:!1,in_condition:1,out_condition:0}],gather:"",gatherList:[{name:"交集",value:2},{name:"并集",value:1},{name:"排除",value:3}],radio:"",operationIndex:0,visibleOperation:!1,operationForm:{crowdName:""},operationRules:{crowdName:[{required:!0,message:"请输入人群名称"}]},deviceForm:{device:""},deviceRule:{device:[{required:!0,message:"请选择设备号类型！"}]},deviceType:[{label:"imei",value:1},{label:"oaid",value:2},{label:"idfa",value:3}],packageID:"",packageStatus:"",packageNum:"",cancel:"",timer:"",loading:!1}},created:function(){this.operationLabelCopy=s["a"].deepCopy(this.operation[0].operationLabel[0],{})},deactivated:function(){this.resetData()},methods:{closeTextDialog:function(){"function"===typeof this.cancel&&(this.cancel(),this.timer&&clearInterval(this.timer))},resetData:function(){this.operation=[{operationLabel:[this.operationLabelCopy],gather:"",addItem:!1,in_condition:1,out_condition:0}],this.$refs.deviceForm.resetFields()},addOperation:function(t){this.radio="",this.operation[t].addItem=!0},handleChange:function(t,e){this.operation.length<3?(this.operation[e].gather=t,this.operation[e].out_condition=t,this.operation.push({operationLabel:[this.operationLabelCopy],gather:"",addItem:!1,in_condition:1,out_condition:t}),this.operation[e].addItem=!1,this.$emit("operationAmount",this.operation.length)):(this.$message.warning("运算池最多可以添加三个!"),this.operation[e].addItem=!1)},deleteOperation:function(t){this.textDialog.showFooter=!0,this.textDialog["class"]="iconfont icon-warning",this.textDialog.text="删除运算池会删除池中全部条件，确定删除？",this.operationIndex=t,this.$refs["delete"].openDialog()},submitDelete:function(){this.operation.splice(this.operationIndex,1),this.operation[this.operation.length-1].gather="",this.$refs["delete"].closeDialog(),this.$emit("operationAmount",this.operation.length)},deleteLabel:function(t,e){this.operation.forEach((function(a,i){t===i&&a.operationLabel.splice(e,1)}))},operationAnd:function(t){this.in_condition=t},operationOr:function(t){this.out_condition=t},axiosData:function(t){var e=this;return this.$http.post("label/commit",Object(h["a"])({},t),{cancelToken:new g.a.CancelToken((function(t){e.cancel=t}))})},axiosPackageStatus:function(){var t=this;return this.$http.get("/crowd/package-status",{params:{package_id:this.packageID},cancelToken:new g.a.CancelToken((function(e){t.cancel=e}))})},closeDialog:function(){this.visibleOperation=!1,this.$refs.operationForm.resetFields()},startOperation:function(){var t=this,e=[];this.operation.forEach((function(t){var a=t.operationLabel.map((function(t){return[t.list]}));e.push({in_condition:t.in_condition,out_condition:t.out_condition,label:a})}));var a={device_num_type:this.deviceForm.device,pool:JSON.stringify(e)};this.$refs.deviceForm.validate((function(e){e&&(t.textDialog.showFooter=!1,t.textDialog["class"]="",t.textDialog.text="计算中，请耐心等待…",t.$refs["delete"].openDialog(),t.axiosData(a).then((function(e){200===e.data.code&&(t.packageID=e.data.data.result.package_id),t.packageID&&(t.timer=setInterval((function(){t.axiosPackageStatus().then((function(e){200===e.data.code&&(t.packageStatus=e.data.data.result.package_status,t.packageNum=e.data.data.result.package_num),1===t.packageStatus&&(clearInterval(t.timer),t.$refs["delete"].closeDialog(),t.visibleOperation=!0)}))["catch"]((function(t){console.warn(t)}))["finally"]((function(){}))}),2e3))}))["catch"]((function(t){console.warn(t)}))["finally"]((function(){})))}))},submitOperation:function(){var t=this;this.$refs.operationForm.validate((function(e){if(e){t.loading=!0;var a={package_id:t.packageID,package_name:t.operationForm.crowdName};t.axiosData(a).then((function(e){if(200===e.data.code)var a=setInterval((function(){t.axiosPackageStatus().then((function(e){200===e.data.code&&(t.packageStatus=e.data.data.result.package_status)}))["catch"]((function(t){console.warn(t)}))["finally"]((function(){2===t.packageStatus&&(clearInterval(a),t.loading=!1,t.$message.success("保存人群成功！"),t.resetData(),t.$refs.operationForm.resetFields(),t.visibleOperation=!1,t.$emit("resetLabelData",t.visibleOperation))}))}),2e3)}))}}))}}},k=D,w=(a("b405"),Object(u["a"])(k,p,b,!1,null,"db5d3f2a",null)),L=w.exports,x={name:"LabelManage",components:{SelectLabel:m,OperationPool:L},data:function(){return{labelInfo:null,amount:1,operationItem:0,state:!0}},deactivated:function(){this.amount=1},methods:{getLabel:function(t,e){this.labelInfo=t,this.operationItem=e},operationAmount:function(t){this.amount=t},resetLabelData:function(t){this.state=t}}},I=x,O=(a("1df7"),Object(u["a"])(I,i,n,!1,null,"36ab70cc",null));e["default"]=O.exports},3360:function(t,e,a){},"3c7d":function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("eb8e");var i=a("84b9");function n(t){if(Array.isArray(t))return Object(i["a"])(t)}a("3836"),a("25bd"),a("87c5"),a("7834"),a("a3ad"),a("8f5f"),a("1981");function o(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}var l=a("0874");function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(t){return n(t)||o(t)||Object(l["a"])(t)||s()}},"63e8":function(t,e,a){},"6b9a":function(t,e,a){"use strict";e["a"]={data:function(){return{dialogVisible:!1,dialogTitle:""}},methods:{openDialog:function(){this.dialogVisible=!0},closeDialog:function(){this.dialogVisible=!1,this.$emit("dialogClose")}}}},"6bb0":function(t,e,a){},"7eeb":function(t,e,a){"use strict";a.d(e,"d",(function(){return i})),a.d(e,"b",(function(){return n})),a.d(e,"e",(function(){return o})),a.d(e,"a",(function(){return l})),a.d(e,"c",(function(){return s}));a("3c7d"),a("dfcf"),a("f904");var i=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=new Date,i=new Date,n=e+t-1;return a.setTime(a.getTime()-864e5*n),i.setTime(i.getTime()-864e5*e),[a,i]},n=function(){var t=new Date,e=new Date,a=t.getDay()>0?t.getDay()-1:6;return e.setTime(e.getTime()-864e5*a),[e,t]},o=function(){var t=new Date,e=new Date,a=t.getDay();return e.setTime(e.getTime()-864e5*(a+6)),t.setTime(t.getTime()-864e5*a),[e,t]},l=function(){var t=new Date,e=new Date,a=t.getDate()-1;return e.setTime(e.getTime()-864e5*a),[e,t]},s=function(){var t=new Date,e=t.getDate(),a=t.getFullYear()-(t.getMonth()>0?0:1),i=(t.getMonth()+11)%12,n=new Date(a,i,1);return t.setTime(t.getTime()-864e5*e),[n,t]}},"84b9":function(t,e,a){"use strict";function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}a.d(e,"a",(function(){return i}))},"8d54":function(t,e,a){"use strict";var i=a("e7b1"),n=a("5a69").find,o=a("3c77"),l="find",s=!0;l in[]&&Array(1)[l]((function(){s=!1})),i({target:"Array",proto:!0,forced:s},{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),o(l)},b405:function(t,e,a){"use strict";a("3360")},cc84:function(t,e,a){"use strict";var i=a("e7b1"),n=a("d10e"),o=a("0f67"),l=a("9e3f"),s=a("dc00"),r=a("9d21"),c=a("f9ce"),d=a("3b6c"),u=a("8340"),f=u("splice"),m=n.TypeError,p=Math.max,b=Math.min,h=9007199254740991,v="Maximum allowed length exceeded";i({target:"Array",proto:!0,forced:!f},{splice:function(t,e){var a,i,n,u,f,g,_=r(this),y=s(_),C=o(t,y),D=arguments.length;if(0===D?a=i=0:1===D?(a=0,i=y-C):(a=D-2,i=b(p(l(e),0),y-C)),y+a-i>h)throw m(v);for(n=c(_,i),u=0;u<i;u++)f=C+u,f in _&&d(n,u,_[f]);if(n.length=i,a<i){for(u=C;u<y-i;u++)f=u+i,g=u+a,f in _?_[g]=_[f]:delete _[g];for(u=y;u>y-i+a;u--)delete _[u-1]}else if(a>i)for(u=y-i;u>C;u--)f=u+i-1,g=u+a-1,f in _?_[g]=_[f]:delete _[g];for(u=0;u<a;u++)_[u+C]=arguments[u+2];return _.length=y-i+a,n}})},eb8e:function(t,e,a){var i=a("e7b1"),n=a("2671");i({target:"Array",stat:!0},{isArray:n})},fd72:function(t,e,a){var i=a("b168"),n=a("3cec").EXISTS,o=a("9e4a"),l=a("6991").f,s=Function.prototype,r=o(s.toString),c=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,d=o(c.exec),u="name";i&&!n&&l(s,u,{configurable:!0,get:function(){try{return d(c,r(this))[1]}catch(t){return""}}})}}]);